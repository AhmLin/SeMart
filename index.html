<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SeMart - Belanja Hemat Produk Rakyat</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/cart.css">
  <link rel="stylesheet" href="css/kategori.css">
  <link rel="stylesheet" href="css/promo-products.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
</head>
<body>

  <header class="navbar">
      <div class="container nav-content">
          <div class="logo">
              <img src="logo2.png" alt="SeMart Logo" width="30px">
              <h1>SeMart</h1>
          </div>
          <div class="search">
              <div class="textinput">
                  <input type="text" placeholder="Cari Produk" id="search-input" aria-label="Cari produk">
              </div>
              <button type="button" id="search-btn">Cari</button>
          </div>
          <nav class="right-nav">
              <ul class="nav-links">
                  <li><a href="index.html" class="active">Beranda</a></li>
                  <li><a href="products.html">Produk</a></li>
                  <li><a href="#">Tentang</a></li>
                  <li><a href="#">Kontak</a></li>
              </ul>
              <div class="cart-section">
                <a href="cart.html" class="cart-link">
                    <div class="cart-info">
                        <div class="cart-total-price">
                            Rp<span id="nav-cart-total">0</span>
                        </div>
                        <div class="cart-icon-with-count">
                            üõí
                            <span class="cart-count" id="nav-cart-count">0</span>
                        </div>
                    </div>
                </a>
            </div>
            
            <!-- üîπ AUTH SECTION - AKAN DIKONTROL OLEH FIREBASE AUTH -->
            <div class="nav-auth" id="nav-auth">
              <a href="login.html" class="btn-login">Login</a>
              <a href="signup.html" class="btn-signup">Daftar</a>
            </div>
            
            <div class="user-menu" id="user-menu" style="display: none;">
              <div class="user-profile">
                <div class="user-avatar">
                   <img src="https://cdn-icons-png.flaticon.com/512/747/747545.png" style="width:60%; filter: brightness(0) invert(1);">
                </div>
                <div class="user-info">
                  <span class="user-greeting">Halo, <span id="user-name">User</span></span>
                  <span class="user-email" id="user-email"></span>
                  <div class="user-dropdown">
                    <a href="profile.html" class="dropdown-item">üìã Profil Saya</a>
                    <a href="orders.html" class="dropdown-item">üì¶ Pesanan Saya</a>
                    <a href="wishlist.html" class="dropdown-item">‚ù§Ô∏è Wishlist</a>
                    <div class="dropdown-divider"></div>
                    <a href="#" id="logout-btn" class="dropdown-item logout">üö™ Logout</a>
                  </div>
                </div>
              </div>
            </div>
          </nav>
      </div>
  </header>
    

  <!-- üîπ Hero Section -->
  <section class="hero">
    <div class="container hero-content">
      <div class="hero-text">
        <h1>Selamat Datang di <span style="color: #007b5e; font-size: 50px;">SeMart</span></h1>
        <p>Belanja hemat, produk rakyat! Temukan berbagai kebutuhan harian dan produk UMKM lokal terbaik dalam satu tempat.<br>SeMart adalah swalayan modern yang menghadirkan kenyamanan belanja dengan harga terjangkau.
Dukung produk lokal, nikmati layanan digital, dan temukan promo menarik setiap hari!</p>
        <a href="products.html" class="btn">Belanja Sekarang</a>
      </div>
      <div class="hero-image">
        <img src="heroimg2.png" alt="Berbagai produk SeMart" loading="lazy" />
      </div>
    </div>
  </section>
  
  <div style="height: 10px;"></div>

  <!-- kategori  -->
  <section class="kategori">
    <div class="container kategori-container">
      <h2>Kategori</h2>
      <div class="kategori-list">
        <div class="kategori-item" style="background-color: #2f5d3b;">
          <a href="katori.html?category=Makanan%20%26%20Minuman" style="color: white; text-decoration: none;">
            <img src="kategori/food and drink.png" alt="Makanan & Minuman">
            <p>Makanan & Minuman</p>
          </a>
        </div>
        <div class="kategori-item" style="background-color: #6ca056;">
          <a href="katori.html?category=Bahan%20Pokok" style="color: white; text-decoration: none;">
            <img src="kategori/bahan pokok.png" alt="Bahan Pokok">
            <p>Bahan Pokok</p>
          </a>
        </div>
        <div class="kategori-item" style="background-color: #b1d25b;">
          <a href="katori.html?category=Bumbu%20Dapur" style="color: white; text-decoration: none;">
            <img src="kategori/bumbu dapur.png" alt="Bumbu & Sembako Kering">
            <p>Bumbu & Sembako Kering</p>            
          </a>
        </div>
        <div class="kategori-item" style="background-color: #d8d0ba;">
          <a href="katori.html?category=Peralatan%20Rumah" style="color: white; text-decoration: none;">
            <img src="kategori/alat rumah tangga.png" alt="Kebutuhan Rumah Tangga">
            <p>Kebutuhan Rumah Tangga</p>            
          </a>
        </div>
        <div class="kategori-item" style="background-color: #c14b4b;">
          <a href="katori.html?category=Kecantikan" style="color: white; text-decoration: none;">
            <img src="kategori/kecantikan.png" alt="Kecantikan">
            <p>Perawatan Tubuh & Kecantikan</p>
          </a>
        </div>
        <div class="kategori-item" style="background-color: #c95050;">
          <a href="katori.html?category=Alat%20Tulis" style="color: white; text-decoration: none;">
            <img src="kategori/alat tulis.png" alt="Alat Tulis & Kantor">
            <p>Alat Tulis & Kantor</p>
          </a>
        </div>
        <div class="kategori-item" style="background-color: #ff6b50;">
          <a href="katori.html?category=Alat%20Bayi" style="color: white; text-decoration: none;">
            <img src="kategori/alat bayi.png" alt="Perlengkapan Bayi & Anak">
            <p>Perlengkapan Bayi & Anak</p>
          </a>
        </div>
      </div>
    </div>
  </section>

  <div style="height: 30px;"></div>

  <!----- Promo ------>
  <div class="promo">
    <div class="leftpromo">
      <div class="slideshow-container">
        <div class="slide fade">
          <img src="promosi/promosi2.png" alt="Promo spesial SeMart" loading="lazy">
        </div>
        <div class="slide fade">
          <img src="promosi/promosi1.png" alt="Penawaran terbatas SeMart" loading="lazy">
        </div>

        <!-- tombol prev/next -->
        <button class="prev" onclick="plusSlides(-1)" aria-label="Slide sebelumnya">‚ùÆ</button>
        <button class="next" onclick="plusSlides(1)" aria-label="Slide berikutnya">‚ùØ</button>
      </div>

      <!-- titik navigasi -->
      <div style="text-align:center">
        <span class="dot" onclick="currentSlide(1)" aria-label="Tampilkan slide 1"></span>
        <span class="dot" onclick="currentSlide(2)" aria-label="Tampilkan slide 2"></span>
      </div>
    </div>
    <div class="rightpromo">
      <div class="rightup">
        <img src="promosi/promo2.jpg" alt="Promo produk unggulan" loading="lazy">
      </div>
      <div class="rightup">
        <img src="promosi/promo1.jpg" alt="Penawaran hari ini" loading="lazy">
      </div>
    </div>
  </div>

  <!-- üîπ Featured Products -->
  <section class="featured">
    <div class="container">
      <h2 class="section-title">Produk Unggulan</h2>
      <div class="product-grid" id="featured-products">
        <!-- Produk unggulan akan dimuat otomatis lewat JS -->
      </div>
    </div>
  </section>

  <!-- üîπ NEW: Promo Products Section -->
  <section class="promo-products">
    <div class="container">
      <div class="promo-header">
        <h2>Promo Spesial <span class="promo-badge">DISKON</span></h2>
      </div>
      <div class="product-grid-promo" id="promo-products">
        <!-- Produk promo akan dimuat otomatis lewat JS -->
      </div>
      <div class="view-all-container">
        <a href="promo-products.html" class="btn-view-all">Lihat Semua Promo</a>
      </div>
    </div>
  </section>

  <!-- üîπ Footer -->
  <footer>
    <div class="footer-content">
      <div class="footer-logo">
        <section style="display: flex; align-items: center; gap: 10px;">
          <img src="logo2.png" alt="SeMart Logo" style="width: 30px;">
          <h2 style="font-size: 20px;">SeMart</h2>
        </section>
        <p>Belanja cerdas, dukung produk lokal bersama SeMart.<br>
          Hemat setiap hari, bahagia setiap belanja!</p>
      </div>
      <div class="follow-me">
        <p>Ikuti Kami</p>
          <ul>
            <li><a href="#" aria-label="Instagram"><img src="instagram.png" alt="Instagram"></a></li>
            <li><a href="#" aria-label="YouTube"><img src="youtube.png" alt="YouTube"></a></li>
            <li><a href="#" aria-label="Twitter"><img src="twitter.png" alt="Twitter"></a></li>
            <li><a href="#" aria-label="WhatsApp"><img src="whatsapp.png" alt="WhatsApp"></a></li>
            <li><a href="#" aria-label="Facebook"><img src="facebook.png" alt="Facebook"></a></li>
          </ul>
      </div>
    </div>
    <div class="container-footer-content">
      <p>&copy; 2025 SeMart Store ‚Äî Semua hak cipta dilindungi.</p>
    </div>
  </footer>

  <!-- üîπ FIREBASE AUTH SCRIPTS -->
  <!-- IMPORTANT: Urutan loading HARUS seperti ini -->
  <script type="module" src="js/firebase-auth.js"></script>
  <script type="module" src="js/simple-auth-fix.js"></script>

  <!-- üîπ CART & MAIN SCRIPTS -->
  <script src="js/cart.js"></script>

  <!-- üîπ MAIN SCRIPT -->
  <script>
    // üîπ SISTEM PENCARIAN
    function setupSearch() {
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        
        if (!searchInput || !searchBtn) return;
        
        // Handle Enter key
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        // Handle button click
        searchBtn.addEventListener('click', performSearch);
    }

    function performSearch() {
        const searchInput = document.getElementById('search-input');
        const searchTerm = searchInput.value.trim();
        
        if (searchTerm) {
            window.location.href = `search-results.html?search=${encodeURIComponent(searchTerm)}`;
        } else {
            alert('Silakan masukkan kata kunci pencarian');
            searchInput.focus();
        }
    }

    // üîπ LOAD FEATURED PRODUCTS
    document.addEventListener("DOMContentLoaded", async () => {
      // Inisialisasi search
      setupSearch();
      
      const featuredContainer = document.getElementById("featured-products");
      const promoContainer = document.getElementById("promo-products");

      try {
        const res = await fetch("data/product.json");
        const products = await res.json();

        // üîπ PERBAIKAN: Filter produk unggulan (handle string "true" dan boolean true)
        const featured = products.filter(p => p.isFeatured === true || p.isFeatured === "true");
        console.log("Jumlah produk unggulan:", featured.length);

        if (featured.length === 0) {
          featuredContainer.innerHTML = "<p style='text-align: center; padding: 2rem;'>Tidak ada produk unggulan saat ini.</p>";
        } else {
          // Tampilkan produk unggulan (maksimal 12)
          const limit = 12;
          const limitedFeatured = featured.slice(0, limit);

          limitedFeatured.forEach(p => {
            // üîπ PERBAIKAN: Parse price ke number
            const price = parseInt(p.price);
            const card = document.createElement("div");
            card.classList.add("product-card");
            card.innerHTML = `
              <img src="${p.image}" alt="${p.name}" loading="lazy" onerror="this.src='images/placeholder-product.jpg'">
              <h3>${p.name}</h3>
              <p>Terjual ${p.sold}</p>
              <div class="rating">
                  ${generateStars(p.rating)} <span>${p.rating.toFixed(1)}</span>
                </div>
              <div class="product-bottom">
                <p class="price">Rp${price.toLocaleString("id-ID")}</p>
                <a href="product.html?id=${p.id}" class="btn-secondary">Lihat Detail</a>
              </div>
            `;
            featuredContainer.appendChild(card);
          });
        }

        // üîπ PERBAIKAN: Filter produk promo (handle string "true" dan boolean true)
        const promoProducts = products.filter(p => p.isPromo === true || p.isPromo === "true");
        console.log("Jumlah produk promo:", promoProducts.length);

        if (promoProducts.length === 0) {
          promoContainer.innerHTML = "<p style='text-align: center; padding: 2rem;'>Tidak ada produk promo saat ini.</p>";
        } else {
          // Tampilkan produk promo (maksimal 10)
          const limit = 10;
          const limitedPromo = promoProducts.slice(0, limit);

          limitedPromo.forEach(p => {
            // üîπ PERBAIKAN: Hitung originalPrice dari discount
            const price = parseInt(p.price);
            const discount = parseInt(p.discount) || 0;
            
            // Jika ada discount, hitung originalPrice
            let originalPrice = price;
            let discountPercentage = discount;
            
            if (discount > 0) {
              originalPrice = Math.round(price / (1 - discount / 100));
            } else {
              // Default 20% discount jika tidak ada discount
              originalPrice = Math.round(price * 1.2);
              discountPercentage = 20;
            }
            
            const card = document.createElement("div");
            card.classList.add("product-card-promo");
            card.innerHTML = `
              <div class="promo-ribbon">${discountPercentage}% OFF</div>
              <img src="${p.image}" alt="${p.name}" loading="lazy" onerror="this.src='images/placeholder-product.jpg'">
              <div class="product-info">
                <h3>${p.name}</h3>
                <p>Terjual ${p.sold}</p>
                <div class="price-container">
                  <span class="original-price">Rp${originalPrice.toLocaleString("id-ID")}</span>
                  <span class="discount-price">Rp${price.toLocaleString("id-ID")}</span>
                  <span class="discount-percentage">${discountPercentage}%</span>
                </div>
                <div class="rating">
                  ${generateStars(p.rating)} <span>${p.rating.toFixed(1)}</span>
                </div>
                <a href="product.html?id=${p.id}" class="btn-secondary">Lihat Detail</a>
              </div>
            `;
            promoContainer.appendChild(card);
          });
        }

      } catch (error) {
        console.error("Gagal memuat produk:", error);
        featuredContainer.innerHTML = `
          <div style="text-align: center; padding: 2rem; color: #666;">
            <p>‚ö†Ô∏è Gagal memuat data produk.</p>
            <p style="font-size: 0.9rem; margin-top: 0.5rem;">${error.message}</p>
            <button onclick="loadSampleProducts()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #007b5e; color: white; border: none; border-radius: 5px; cursor: pointer;">
              Muat Produk Contoh
            </button>
          </div>
        `;
        promoContainer.innerHTML = "";
      }
    });

    // üîπ FALLBACK PRODUCTS - Diperbarui sesuai format data Anda
    function loadSampleProducts() {
      const featuredContainer = document.getElementById("featured-products");
      const promoContainer = document.getElementById("promo-products");
      
      const sampleProducts = [
        {
          id: "1",
          name: "Bagus Sapu Lantai",
          price: 25000,
          category: "Peralatan Rumah",
          image: "img/Bagus Sapu Lantai.jpg",
          description: "Sapu lantai dengan gagang kuat dan serat halus untuk pembersihan maksimal.",
          stock: 30,
          rating: 4.06,
          sold: 120,
          discount: 10,
          isPromo: true,
          isFeatured: "true",
          tags: ["sapu", "kebersihan", "rumah"]
        },
        {
          id: "2",
          name: "Minyak Goreng 2L",
          price: 28000,
          category: "Bahan Pokok",
          image: "https://via.placeholder.com/300x200?text=Minyak+Goreng",
          description: "Minyak goreng berkualitas untuk memasak sehari-hari",
          stock: 50,
          rating: 4.5,
          sold: 890,
          discount: 15,
          isPromo: true,
          isFeatured: "true",
          tags: ["minyak", "masak", "bahan pokok"]
        },
        {
          id: "3",
          name: "Beras Premium 5kg",
          price: 65000,
          category: "Bahan Pokok",
          image: "https://via.placeholder.com/300x200?text=Beras+Premium",
          description: "Beras premium kualitas terbaik",
          stock: 25,
          rating: 4.8,
          sold: 1250,
          discount: 0,
          isPromo: false,
          isFeatured: "true",
          tags: ["beras", "makanan pokok"]
        },
        {
          id: "4",
          name: "Sabun Mandi 90g",
          price: 5000,
          category: "Kecantikan",
          image: "https://via.placeholder.com/300x200?text=Sabun+Mandi",
          description: "Sabun mandi dengan wangi segar",
          stock: 100,
          rating: 4.4,
          sold: 450,
          discount: 20,
          isPromo: true,
          isFeatured: false,
          tags: ["sabun", "mandi", "kebersihan"]
        },
        {
          id: "5",
          name: "Shampoo 200ml",
          price: 18000,
          category: "Kecantikan",
          image: "https://via.placeholder.com/300x200?text=Shampoo",
          description: "Shampoo untuk rambut sehat berkilau",
          stock: 40,
          rating: 4.5,
          sold: 380,
          discount: 25,
          isPromo: true,
          isFeatured: false,
          tags: ["shampoo", "rambut", "perawatan"]
        },
        {
          id: "6",
          name: "Gula Pasir 1kg",
          price: 15000,
          category: "Bahan Pokok",
          image: "https://via.placeholder.com/300x200?text=Gula+Pasir",
          description: "Gula pasir kualitas premium",
          stock: 60,
          rating: 4.6,
          sold: 750,
          discount: 10,
          isPromo: true,
          isFeatured: "true",
          tags: ["gula", "pemanis", "bahan masak"]
        }
      ];

      // Load featured products
      const featuredProducts = sampleProducts.filter(p => p.isFeatured === true || p.isFeatured === "true");
      featuredContainer.innerHTML = '';
      
      featuredProducts.forEach(p => {
        const price = parseInt(p.price);
        const card = document.createElement("div");
        card.classList.add("product-card");
        card.innerHTML = `
          <img src="${p.image}" alt="${p.name}" loading="lazy">
          <h3>${p.name}</h3>
          <p>Terjual ${p.sold}</p>
          <div class="rating">
              ${generateStars(p.rating)} <span>${p.rating.toFixed(1)}</span>
            </div>
          <div class="product-bottom">
            <p class="price">Rp${price.toLocaleString("id-ID")}</p>
            <a href="product.html?id=${p.id}" class="btn-secondary">Lihat Detail</a>
          </div>
        `;
        featuredContainer.appendChild(card);
      });
      
      // Load promo products
      const promoProducts = sampleProducts.filter(p => p.isPromo === true || p.isPromo === "true");
      promoContainer.innerHTML = '';
      
      promoProducts.forEach(p => {
        const price = parseInt(p.price);
        const discount = parseInt(p.discount) || 0;
        
        // Hitung originalPrice dari discount
        let originalPrice = price;
        let discountPercentage = discount;
        
        if (discount > 0) {
          originalPrice = Math.round(price / (1 - discount / 100));
        } else {
          // Default 20% discount jika tidak ada discount
          originalPrice = Math.round(price * 1.2);
          discountPercentage = 20;
        }
        
        const card = document.createElement("div");
        card.classList.add("product-card-promo");
        card.innerHTML = `
          <div class="promo-ribbon">${discountPercentage}% OFF</div>
          <img src="${p.image}" alt="${p.name}" loading="lazy">
          <div class="product-info">
            <h3>${p.name}</h3>
            <p>Terjual ${p.sold}</p>
            <div class="price-container">
              <span class="original-price">Rp${originalPrice.toLocaleString("id-ID")}</span>
              <span class="discount-price">Rp${price.toLocaleString("id-ID")}</span>
              <span class="discount-percentage">${discountPercentage}%</span>
            </div>
            <div class="rating">
              ${generateStars(p.rating)} <span>${p.rating.toFixed(1)}</span>
            </div>
            <a href="product.html?id=${p.id}" class="btn-secondary">Lihat Detail</a>
          </div>
        `;
        promoContainer.appendChild(card);
      });
    }

    function generateStars(rating) {
      const fullStars = Math.floor(rating);
      const halfStar = rating % 1 >= 0.5 ? 1 : 0;
      const emptyStars = 5 - fullStars - halfStar;

      return "‚òÖ".repeat(fullStars) + "¬Ω".repeat(halfStar) + "‚òÜ".repeat(emptyStars);
    }

    // üîπ SLIDESHOW FUNCTIONS
    let slideIndex = 1;
    showSlides(slideIndex);

    function plusSlides(n) {
      showSlides(slideIndex += n);
    }

    function currentSlide(n) {
      showSlides(slideIndex = n);
    }

    function showSlides(n) {
      const slides = document.getElementsByClassName("slide");
      const dots = document.getElementsByClassName("dot");

      if (n > slides.length) slideIndex = 1;
      if (n < 1) slideIndex = slides.length;

      for (let i = 0; i < slides.length; i++) {
        slides[i].style.display = "none";  
      }

      for (let i = 0; i < dots.length; i++) {
        dots[i].className = dots[i].className.replace(" active", "");
      }

      slides[slideIndex-1].style.display = "block";  
      dots[slideIndex-1].className += " active";
    }

    // otomatis slideshow
    setInterval(() => { plusSlides(1); }, 5000);
  </script>
</body>
</html>
